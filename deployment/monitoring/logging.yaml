apiVersion: fluentbit.fluent.io/v1alpha2
kind: ClusterFluentBitConfig
metadata:
  name: shamba-logging
spec:
  service:
    flush: 5
  pipelineStages:
    - filter:
        name: kubernetes
        match: "kube.*"
    - filter:
        name: rewrite_tag
        match: "*"
        rule: "$log ^(.*)$ backend.$TAG true"
  outputs:
    - name: loki
      match: "backend.*"
      type: loki
      url: http://loki.monitoring:3100/loki/api/v1/push
